(function($) {

	$.fn.SUPER_Popup = function( event ) {

		var SUPER_Popup = {

			settings: {  
				event: event || 'click'
			},
			
			// Initialize Popup 
			initialize: function( self ) { 
				var popup_element_id = self[0].id; 
				var popup = $( '#' + popup_element_id + '.super-popup' );  
				var close = $( '#' + popup_element_id + ' .super-popup-close' );   
				SUPER_Popup.display_popup_settings( popup ); 
				close.on( 'click', function() {
					SUPER_Popup.hide( popup );
					return false;
				});
				$( window ).click(function(e) {
					if (!$(e.target).parents().andSelf().is(self)) {
						SUPER_Popup.hide( popup );
					}
				});
				$( window ).keyup(function(e) {
					if ( e.keyCode === 27 ) {
						SUPER_Popup.hide( popup );
					}
				});
			},

			// Centering method
			centering: function( self ) {
				self.removeClass('super-popup-slide-top');
				self.show();

				if($('body .super-popup-overlay').length==0){
					$('body').prepend('<div class="super-popup-overlay"></div>');
				}
				var popup_overlay_color = '#000000';
				if($.trim(SUPER_Popup.settings.event.popup_overlay_color) != ''){
					popup_overlay_color = $.trim(SUPER_Popup.settings.event.popup_overlay_color);
				}
				var popup_overlay_opacity = '#000000';
				if($.trim(SUPER_Popup.settings.event.popup_overlay_opacity) != ''){
					popup_overlay_opacity = $.trim(SUPER_Popup.settings.event.popup_overlay_opacity);
				}
				$('.super-popup-overlay').css({ 
					'background': popup_overlay_color,
					'opacity': popup_overlay_opacity,
				});

				var space_from_top = 100;
				var left_position = (($(window).width() - self.outerWidth()) / 2) + $(window).scrollLeft();
				var right_position = (($(window).width() - self.outerWidth()) / 2) + $(window).scrollLeft();
				var top_position = ($(window).scrollTop()+space_from_top);
				var bottom_position = ((($(window).height() - self.outerHeight()) / 2) + $(window).scrollTop())+(space_from_top/3);
				var default_slide_duration = 1000; 

				//Popup FadeIn duration in milliseconds (0 is no fade effect)
				if( parseInt(SUPER_Popup.settings.event.popup_fade_duration) > default_slide_duration ) {
					default_slide_duration = parseInt( SUPER_Popup.settings.event.popup_fade_duration );
				}

				// Make popup sticky (stick to top, right, bottom or left) 
				if( $.trim( SUPER_Popup.settings.event.popup_sticky ) != 'default' ) {
					var sticky_type = $.trim( SUPER_Popup.settings.event.popup_sticky ); 
					if( $.trim( sticky_type ) == 'top' ){
						top_position = 0;
						self.hide().css({ 
							'top':  top_position + 'px',
							'left':  left_position + 'px' , 
							'opacity': 1,
						}).fadeIn(parseInt(SUPER_Popup.settings.event.popup_fade_duration));  
					}
					else if( $.trim( sticky_type ) == 'left' ) {
						left_position = 0;
						self.hide().css({ 
							'top':  top_position + 'px',
							'left':  left_position + 'px' , 
							'opacity': 1,
						}).fadeIn(parseInt(SUPER_Popup.settings.event.popup_fade_duration));  
					}
					else if( $.trim( sticky_type ) == 'bottom' ){ 
						 bottom_position = 0;
						 self.hide().css({  
							'bottom':  bottom_position + 'px', 
							'left':  left_position + 'px' , 
							'opacity': 1,
						 }).fadeIn(parseInt(SUPER_Popup.settings.event.popup_fade_duration));  
					}  
					else if( $.trim( sticky_type ) == 'right' ) {
						right_position = 0;
						self.hide().css({ 
							'top':  top_position + 'px',
							'right':  right_position + 'px' , 
							'opacity': 1,
						 }).fadeIn(parseInt(SUPER_Popup.settings.event.popup_fade_duration));
					} 
					return;
				}

				// Default popup slide show
				if( SUPER_Popup.settings.event.popup_slide  == 'default' ) {
					self.hide().css({ 
						'top':  top_position + 'px',
						'left':  left_position + 'px' , 
						'opacity': 1,
					}).fadeIn(parseInt(SUPER_Popup.settings.event.popup_fade_duration));  
				}

				// Slide from bottom
				if( SUPER_Popup.settings.event.popup_slide  == 'from_bottom' ) {
					self.css({ 
						'bottom': '0px',
						'left':  left_position + 'px',
					}).animate({
							opacity: 1,
							bottom: bottom_position + 'px' 
					},default_slide_duration); 
				}

				// Slide from right
				if( SUPER_Popup.settings.event.popup_slide  == 'from_right' ) {
					self.css({ 
						'top': top_position + 'px',
						'right':  '0px', 
					}).animate({
							opacity: 1,
							right: right_position + 'px' 
					},default_slide_duration);  
				}

				// Slide from top
				if( SUPER_Popup.settings.event.popup_slide  == 'from_top' ) {
					self.css({ 
						'top': '0px', 
						'left':  left_position + 'px' , 
					}).animate({
							top: top_position + 'px',
							opacity:1,
					},default_slide_duration);  
				}

				// Slide from left
				if( SUPER_Popup.settings.event.popup_slide  == 'from_left' ) {
					self.css({ 
						'top': top_position + 'px',
						'left':  '0px', 
					}).animate({
							opacity: 1,
							left: left_position + 'px' 
					},default_slide_duration);  
				}
			},

			// The overall function of the show
			show: function( popup ) {
				if( $.trim(SUPER_Popup.settings.event.popup_from) != '' && $.trim(SUPER_Popup.settings.event.popup_till) != '' ) {
						
					// Display the popup within specific date range.
					var popup_from = $.trim(SUPER_Popup.settings.event.popup_from);
					var popup_till = $.trim(SUPER_Popup.settings.event.popup_till);
					var currentDate = new Date();

					popup_from = popup_from.split('-');
					popup_from = popup_from[1]+'/'+popup_from[2]+'/'+popup_from[0];

					popup_till = popup_till.split('-');
					popup_till = popup_till[1]+'/'+popup_till[2]+'/'+popup_till[0];

					currentDate =  (currentDate.getMonth() + 1)+'/'+currentDate.getDate()+'/'+currentDate.getFullYear();

					if(SUPER_Popup.datecheck(popup_from, popup_till, currentDate)) {
						 common_configure = SUPER_Popup.common_configure( popup );
						 SUPER_Popup.centering( common_configure );
					}

					SUPER.init_super_responsive_form_fields();

				}
			},

			// The overall function of the hide
			hide: function( popup ) {
				popup.addClass( 'super-popup-slide-top' ).hide(); 
				$('.super-popup-overlay').remove();
			}, 

			// Popup layout settings
			common_configure: function( popup ) { 

				// Background color 
				if( $.trim(SUPER_Popup.settings.event.popup_background_color) != '' ) {
					popup.css('background-color',$.trim(SUPER_Popup.settings.event.popup_background_color));
				}

				// Background Image
				if( $.trim(SUPER_Popup.settings.event.popup_background_image) != '' ) {
					popup.css('background-image','url('+$.trim(SUPER_Popup.settings.event.popup_background_image)+')');
				}

				// Background image repeat
				if( $.trim(SUPER_Popup.settings.event.popup_popup_background_image_repeat) != '' ) {
					popup.css('background-repeat',$.trim(SUPER_Popup.settings.event.popup_popup_background_image_repeat));
				}

				// Background image size
				if( $.trim(SUPER_Popup.settings.event.popup_popup_background_image_size) != '' ) {
					 popup.css('background-size',$.trim(SUPER_Popup.settings.event.popup_popup_background_image_size));
				}

				// Border radius  
				var border_radius = SUPER_Popup.settings.event.popup_border_radius_top_left+'px ';
				border_radius += SUPER_Popup.settings.event.popup_border_radius_top_right+'px '; 
				border_radius += SUPER_Popup.settings.event.popup_border_radius_bottom_right+'px ';
				border_radius += SUPER_Popup.settings.event.popup_border_radius_bottom_left+'px '; 

				// Set border radius to popup 
				popup.css('border-radius', border_radius);
				popup.css('-moz-border-radius', border_radius);
				popup.css('-webkit-border-radius', border_radius);  

				// Border size in Pixels (px)
				if( $.trim(SUPER_Popup.settings.event.popup_border_size) != '' ) {
					
					var border_color = '';

					// Border color
					if( $.trim(SUPER_Popup.settings.event.popup_border_color) != '' ) {
							 border_color = $.trim(SUPER_Popup.settings.event.popup_border_color);
					}

					popup.css('border',$.trim(SUPER_Popup.settings.event.popup_border_size)+'px'+' solid '+border_color);

				} 

				// Background shadow    
				var box_shadow = SUPER_Popup.settings.event.popup_shadow_horizontal_length+'px ';
				box_shadow += SUPER_Popup.settings.event.popup_shadow_vertical_length+'px ';
				box_shadow += SUPER_Popup.settings.event.popup_blur_radius+'px ';
				box_shadow += SUPER_Popup.settings.event.popup_spread_radius+'px '; 
				box_shadow += SUPER_Popup.hexToRgba( SUPER_Popup.settings.event.popup_shadow_color, SUPER_Popup.settings.event.popup_shadow_opacity );

				// Set background shadow to popup
				popup.css('-webkit-box-shadow', box_shadow);
				popup.css('-moz-box-shadow', box_shadow);
				popup.css('box-shadow', box_shadow);

				return popup;

			},

			// Convert color code to rgba
			hexToRgba: function (hex, a) {
				var bigint, r, g, b;
				var re = /^#?/;
				var aRgb = hex.replace(re, '');
				if (aRgb.length == 3) {
						bigint = parseInt(aRgb, 16);
						r = (bigint >> 4) & 255;
						g = (bigint >> 2) & 255;
						b = bigint & 255;
						return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';
				}
				if (aRgb.length == 6) {
						bigint = parseInt(aRgb, 16);
						r = (bigint >> 16) & 255;
						g = (bigint >> 8) & 255;
						b = bigint & 255;
						return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';
				}
			},

			// Compare date with date range
			datecheck: function( fromdate, todate, checkdate ) {
				var popup_from,to_date,check_date;
				popup_from = Date.parse(fromdate);
				to_date = Date.parse(todate);
				check_date = Date.parse(checkdate);
				if( ( check_date <= to_date && check_date >= popup_from ) ) {
					return true;
				}
				return false;
			},

			// Display popup on settings events
			display_popup_settings: function( popup ) {   
				
				// Close button (X) on top right corner of the popup
				if( (SUPER_Popup.settings.event.popup_close_button)  == 'true' ) {
					popup.children('.super-popup-close').show();
				}else{
					popup.children('.super-popup-close').hide();
				}

				// Popup open settings
				if( (SUPER_Popup.settings.event.popup_exit_intent)  == 'true' ) {
					// Exit intent
					var flg_open = 0;
					jQuery(document).bind('mouseleave', function(e) {
						SUPER_Popup.show( popup );
						flg_open = 1;
					});
				}else if( (SUPER_Popup.settings.event.popup_leave)  == 'true' ) {
					// Display the popup on page leave / page close/exit
					var flg_open = 0;
					window.addEventListener('beforeunload', function (e) {
						SUPER_Popup.show( popup );
						flg_open = 1;
						var $msg = SUPER_Popup.settings.event.popup_leave_msg;
						(e || window.event).returnValue = $msg;
					    return $msg;
					});
				}else if( parseInt(SUPER_Popup.settings.event.popup_scrolled) > 0 ) {
					// Display the popup when user scrolled xx% of the page
					var page_height = $(document).height() - $(window).height();  
					var flg_open = 0;
					$( window ).scroll(function() {    
						var scroll_level = $(window).scrollTop();  
						var scroll_level_percentage = ( parseInt(scroll_level) * 100 ) / page_height; 
						if( flg_open == 0 && parseInt(scroll_level_percentage) == parseInt(SUPER_Popup.settings.event.popup_scrolled) ) {
							SUPER_Popup.show( popup );
							flg_open = 1;
						} 
					}); 
				}else if( parseInt(SUPER_Popup.settings.event.popup_seconds ) > 0 ) {
					 // Display popup after X seconds  
					 setTimeout(function(){
						SUPER_Popup.show( popup )
					 }, parseInt(SUPER_Popup.settings.event.popup_seconds) * 1000 );
				}else if( (SUPER_Popup.settings.event.popup_page_load) == 'true' ) {
					 SUPER_Popup.show( popup );
				}else if( parseInt(SUPER_Popup.settings.event.popup_inactivity) > 0 ) {
					// Display popup after X seconds of inactivity
					var idleTimer = null;
					var idleState = false;
					var idleWait = parseInt(SUPER_Popup.settings.event.popup_inactivity) * 1000;
					$('*').bind('mousemove hover dblclick mouseenter mouseleave click mouseup mousedown keydown scroll', function () {
						if(!idleState) {
							clearTimeout(idleTimer);
							idleTimer = setTimeout(function () {
								SUPER_Popup.show( popup );
								idleState = true;
								clearTimeout(idleTimer);
							}, idleWait);
						}
					});
					$('body').trigger('mousemove');
				 }else{
					// Default open popup on page load
					SUPER_Popup.show( popup );
				 }
			},
		};

		// In loop looking for what is called
		return this.each(function() {
			var self = $(this);
			SUPER_Popup.initialize( self );
		});
	};
})(jQuery);